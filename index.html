<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Pollution Estimation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/geotiff@2.0.7/dist-browser/geotiff.js"></script>
    <script src="geotiff-loader.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="map-container">
            <div id="map-view"></div>
            
            <!-- Year/Month Slider Widget -->
            <div class="floating-widget time-selector-widget">
                <div class="time-selector-content">
                    <button id="pollutant-selector" class="year-selector-btn">O3</button>
                    <button id="year-selector" class="year-selector-btn">2024</button>
                    <div class="month-slider-wrapper">
                        <input type="range" id="month-slider" class="month-slider" min="1" max="12" value="1" step="1">
                        <div class="month-slider-labels">
                            <span>Jan</span>
                            <span>Feb</span>
                            <span>Mar</span>
                            <span>Apr</span>
                            <span>May</span>
                            <span>Jun</span>
                            <span>Jul</span>
                            <span>Aug</span>
                            <span>Sep</span>
                            <span>Oct</span>
                            <span>Nov</span>
                            <span>Dec</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Floating Explanation Widget -->
            <div class="floating-widget explanation-widget collapsed">
                <button class="collapse-btn" id="explanation-collapse" aria-label="Expand info panel">›</button>
                <div class="collapsed-banner">
                    <span>Air Pollution Estimation</span>
                </div>
                <!-- Collapsed titles (visible when panel is collapsed) -->
                <div class="collapsed-titles">
                    <button class="collapsed-title-btn" data-slide="0">Introduction</button>
                    <button class="collapsed-title-btn" data-slide="1">Data Collection</button>
                    <button class="collapsed-title-btn" data-slide="2">Model</button>
                    <button class="collapsed-title-btn" data-slide="3">Results</button>
                    <button class="collapsed-title-btn" data-slide="4">Authors</button>
                </div>
                <div class="title-widget inline-title">
                    <img src="images/Maps-Layers-icon.png" alt="Layers" class="title-icon" />
                    <h1>Air Pollution Estimation</h1>
                </div>
                <!-- Folder-like Tab Structure -->
                <div class="desktop-folder-container">
                    <div class="desktop-folder-tabs">
                        <!-- Collapsed Icon (shown when widget is collapsed) -->
                        <div class="collapsed-icon-vertical">
                            <img src="images/Maps-Layers-icon.png" alt="Layers" />
                        </div>
                        <button class="desktop-folder-tab active" data-tab="info" data-slide="0">
                            <div>
                                <span>Introduction</span>
                            </div>
                        </button>
                        <button class="desktop-folder-tab" data-tab="info" data-slide="1">
                            <div>
                                <span>Data Collection</span>
                            </div>
                        </button>
                        <button class="desktop-folder-tab" data-tab="info" data-slide="2">
                            <div>
                                <span>Model</span>
                            </div>
                        </button>
                        <button class="desktop-folder-tab" data-tab="info" data-slide="3">
                            <div>
                                <span>Results</span>
                            </div>
                        </button>
                        <button class="desktop-folder-tab" data-tab="info" data-slide="4">
                            <div>
                                <span>Authors</span>
                            </div>
                        </button>
                        <button class="desktop-folder-tab" data-tab="controls">
                            <div>
                                <span>City Predictions</span>
                            </div>
                        </button>
                    </div>
                    <div class="desktop-folder-content">
                        <!-- Info Panel (explanation carousel) -->
                        <div class="desktop-panel desktop-info-panel active" id="desktop-info-panel">
                            <div class="explanation-carousel">
                                <div class="carousel-container">
                                    <div class="carousel-slide active">
                                        <div class="slide-content">
                                            <h2 class="slide-title">Introduction</h2>
                                            <div id="slide-introduction"></div>
                                        </div>
                                    </div>
                                    <div class="carousel-slide">
                                        <div class="slide-content">
                                            <h2 class="slide-title">Data Collection</h2>
                                            <div id="slide-data-collection"></div>
                                        </div>
                                    </div>
                                    <div class="carousel-slide">
                                        <div class="slide-content">
                                            <h2 class="slide-title">Model</h2>
                                            <div id="slide-model"></div>
                                        </div>
                                    </div>
                                    <div class="carousel-slide">
                                        <div class="slide-content">
                                            <h2 class="slide-title">Results</h2>
                                            <div id="slide-results">
                                                <p>The multi-pollutant architecture achieved results comparable to those of Scheibenreil et al. for NO₂ ($R^2$=0.50) and good values for O₃ ($R^2$=0.51).</p>
                                                <p>PM₁₀ prediction proved feasible ($R^2$=0.29) by exploiting visual features (e.g., construction sites), whereas PM₂.₅ performance was limited ($R^2$=0.16), likely due to the backbone abstracting away necessary short-wavelength spectral interactions.</p>
                                                <p>Finally, the model failed to generalize for SO₂ ($R^2$&lt;0) due to the extreme sparsity of emission sources.</p>
                                                <table>
                                                    <thead>
                                                        <tr>
                                                            <th>Pollutant</th>
                                                            <th>MAE</th>
                                                            <th>MSE</th>
                                                            <th>MBE</th>
                                                            <th>$R^2$</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td><strong>NO₂</strong></td>
                                                            <td>5.69</td>
                                                            <td>7.9</td>
                                                            <td>-0.07</td>
                                                            <td>0.5</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>O₃</strong></td>
                                                            <td>8.97</td>
                                                            <td>11.6</td>
                                                            <td>-1.7</td>
                                                            <td>0.51</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>PM₁₀</strong></td>
                                                            <td>6.37</td>
                                                            <td>9.58</td>
                                                            <td>-0.78</td>
                                                            <td>0.29</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>PM₂.₅</strong></td>
                                                            <td>1.89</td>
                                                            <td>2.61</td>
                                                            <td>-0.14</td>
                                                            <td>0.16</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>SO₂</strong></td>
                                                            <td>1.14</td>
                                                            <td>1.78</td>
                                                            <td>-0.27</td>
                                                            <td>-0.17</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="carousel-slide">
                                        <div class="slide-content">
                                        <h2 class="slide-title">Acknowledgements &amp; Authors</h2>
                                            <div id="authors-slide"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Navigation Arrows -->
                                <div class="carousel-nav-arrows" id="carousel-nav-arrows">
                                    <button class="carousel-arrow carousel-arrow-next" id="carousel-next" aria-label="Next slide">
                                        <img src="images/arrow_down.jpg" alt="Next slide" class="arrow-icon" />
                                    </button>
                                </div>
                                <div class="carousel-indicators">
                                    <span class="indicator active" data-slide="0"></span>
                                    <span class="indicator" data-slide="1"></span>
                                    <span class="indicator" data-slide="2"></span>
                                    <span class="indicator" data-slide="3"></span>
                                    <span class="indicator" data-slide="4"></span>
                                </div>
                            </div>
                        </div>
                        <!-- Controls Panel -->
                        <div class="desktop-panel desktop-controls-panel" id="desktop-controls-panel">
                            <div class="desktop-controls-content">
                                <h2 class="slide-title">Select City</h2>
                                <div class="desktop-controls-section">
                                    <div class="desktop-location-selector">
                                        <div class="desktop-location-buttons">
                                            <button class="desktop-location-btn" data-location="frascati" data-center="[12.68, 41.81]" data-zoom="13">
                                                Frascati
                                            </button>
                                            <button class="desktop-location-btn active" data-location="bologna" data-center="[11.34, 44.49]" data-zoom="13">
                                                Bologna
                                            </button>
                                            <button class="desktop-location-btn" data-location="milano" data-center="[9.19, 45.46]" data-zoom="13">
                                                Milano
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Toggle Button -->
            <button id="mobile-toggle" class="mobile-toggle-btn">
                <span class="toggle-label" id="toggle-label">Info</span>
            </button>
            
            <!-- Info Popup Modal -->
            <div id="info-popup" class="info-popup hidden">
                <div class="info-popup-overlay"></div>
                <div class="info-popup-content">
                    <button class="info-popup-close">&times;</button>
                    <h2 class="info-popup-title">Information</h2>
                    <div class="info-popup-sections">
                        <div class="info-section">
                            <h3 class="info-section-title">GitHub Repository</h3>
                            <div id="github-content" class="info-section-content">
                                <p>Source code and documentation available on GitHub:</p>
                                <a href="https://github.com/yourusername/air-pollution-estimation" target="_blank" rel="noopener noreferrer" class="info-link">github.com/yourusername/air-pollution-estimation</a>
                            </div>
                        </div>
                        <div class="info-section">
                            <h3 class="info-section-title">Additional Information</h3>
                            <div id="additional-content" class="info-section-content">
                                <p><strong>Data Sources:</strong> Satellite imagery from Sentinel-5P, ground-based monitoring stations, and meteorological data.</p>
                                <p><strong>Methodology:</strong> Machine learning model trained on historical air quality data and satellite observations.</p>
                                <p><strong>Contact:</strong> For questions or collaboration, please reach out via GitHub or email at your.email@example.com</p>
                            </div>
                        </div>
                        <div class="info-section">
                            <h3 class="info-section-title">References</h3>
                            <div id="references-content" class="info-section-content"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Floating Feature Info Widget -->
            <div id="feature-info" class="floating-widget feature-widget hidden">
                <h2>Feature Details</h2>
                <div id="feature-content"></div>
            </div>
            
            <!-- Image Popup Modal -->
            <div id="image-popup" class="image-popup hidden">
                <div class="popup-overlay"></div>
                <div class="popup-content">
                    <button class="popup-close">&times;</button>
                    <img src="images/geological_domains.jpg" alt="Geological Domains">
                    <div class="popup-reference">
                        Guido Pastore et al. 2021 - <a href="https://www.sciencedirect.com/science/article/pii/S0012825221001069#f0015" target="_blank" rel="noopener noreferrer">Reference</a>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Info Panel (slides up from bottom - OUTSIDE tab switcher) -->
            <div class="mobile-info-panel" id="mobile-info-panel">
                <div class="mobile-info-panel-content">
                    <h1 class="mobile-info-title">Air Pollution Estimation</h1>
                    <p class="mobile-info-subtitle"></p>
                    <div class="mobile-info-carousel">
                        <div class="mobile-info-carousel-container">
                            <div class="mobile-info-slide active">
                                <h2 class="mobile-info-slide-title">Introduction</h2>
                                <div id="mobile-slide-introduction"></div>
                            </div>
                            <div class="mobile-info-slide">
                                <h2 class="mobile-info-slide-title">Data Collection</h2>
                                <div id="mobile-slide-data-collection"></div>
                            </div>
                            <div class="mobile-info-slide">
                                <h2 class="mobile-info-slide-title">Model</h2>
                                <div id="mobile-slide-model"></div>
                            </div>
                            <div class="mobile-info-slide">
                                <h2 class="mobile-info-slide-title">Results</h2>
                                <div id="mobile-slide-results">
                                    <p>The multi-pollutant architecture achieved results comparable to those of Scheibenreil et al. for NO₂ ($R^2$=0.50) and good values for O₃ ($R^2$=0.51).</p>
                                    <p>PM₁₀ prediction proved feasible ($R^2$=0.29) by exploiting visual features (e.g., construction sites), whereas PM₂.₅ performance was limited ($R^2$=0.16), likely due to the backbone abstracting away necessary short-wavelength spectral interactions.</p>
                                    <p>Finally, the model failed to generalize for SO₂ ($R^2$&lt;0) due to the extreme sparsity of emission sources.</p>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Pollutant</th>
                                                <th>MAE</th>
                                                <th>MSE</th>
                                                <th>MBE</th>
                                                <th>$R^2$</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>NO₂</strong></td>
                                                <td>5.69</td>
                                                <td>7.9</td>
                                                <td>-0.07</td>
                                                <td>0.5</td>
                                            </tr>
                                            <tr>
                                                <td><strong>O₃</strong></td>
                                                <td>8.97</td>
                                                <td>11.6</td>
                                                <td>-1.7</td>
                                                <td>0.51</td>
                                            </tr>
                                            <tr>
                                                <td><strong>PM₁₀</strong></td>
                                                <td>6.37</td>
                                                <td>9.58</td>
                                                <td>-0.78</td>
                                                <td>0.29</td>
                                            </tr>
                                            <tr>
                                                <td><strong>PM₂.₅</strong></td>
                                                <td>1.89</td>
                                                <td>2.61</td>
                                                <td>-0.14</td>
                                                <td>0.16</td>
                                            </tr>
                                            <tr>
                                                <td><strong>SO₂</strong></td>
                                                <td>1.14</td>
                                                <td>1.78</td>
                                                <td>-0.27</td>
                                                <td>-0.17</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="mobile-info-slide">
                                <h2 class="mobile-info-slide-title">Acknowledgements &amp; Authors</h2>
                                <div id="authors-mobile"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Indicators fixed at bottom of panel -->
                <div class="mobile-info-carousel-indicators">
                    <span class="mobile-info-indicator active" data-slide="0"></span>
                    <span class="mobile-info-indicator" data-slide="1"></span>
                    <span class="mobile-info-indicator" data-slide="2"></span>
                    <span class="mobile-info-indicator" data-slide="3"></span>
                    <span class="mobile-info-indicator" data-slide="4"></span>
                </div>
            </div>
            
            <!-- Mobile Tab Switcher (only visible on mobile) -->
            <div class="mobile-tab-switcher" id="mobile-tab-switcher">
                <!-- Color Bar Legend - at top of widget -->
                <div class="mobile-colorbar" id="mobile-colorbar">
                    <span class="colorbar-unit">µg/m³ </span>
                    <span class="colorbar-value colorbar-min" id="colorbar-min">20</span>
                    <div class="colorbar-gradient"></div>
                    <span class="colorbar-value colorbar-max" id="colorbar-max">80</span>
                </div>
                <!-- Month Selector (shown when Predictions tab is active) -->
                <div class="mobile-month-selector">
                    <div class="mobile-month-selector-content">
                        <div class="mobile-controls-row">
                            <button class="mobile-control-btn" id="mobile-pollutant-btn">O3</button>
                            <button class="mobile-control-btn" id="mobile-year-btn">2024</button>
                        </div>
                        <div class="mobile-month-slider-wrapper">
                            <input type="range" id="mobile-month-slider" class="mobile-month-slider" min="1" max="12" value="1" step="1">
                            <div class="mobile-month-slider-labels">
                                <span>Jan</span>
                                <span>Feb</span>
                                <span>Mar</span>
                                <span>Apr</span>
                                <span>May</span>
                                <span>Jun</span>
                                <span>Jul</span>
                                <span>Aug</span>
                                <span>Sep</span>
                                <span>Oct</span>
                                <span>Nov</span>
                                <span>Dec</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mobile-tab-slider">
                    <div class="mobile-tab-track">
                        <button class="mobile-tab active" data-tab="predictions">Predictions</button>
                        <button class="mobile-tab" data-tab="info">Info</button>
                    </div>
                    <div class="mobile-tab-indicator"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>

